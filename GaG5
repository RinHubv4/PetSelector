--// SERVICES
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local gui = player:WaitForChild("PlayerGui")

--// GUI ROOT
local ScreenGui = Instance.new("ScreenGui", gui)
ScreenGui.Name = "RinTradeUI_V3"
ScreenGui.ResetOnSpawn = false

--// MAIN PANEL
local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0, 300, 0, 240)
Main.Position = UDim2.new(0.5, -150, 0.5, -120)
Main.BackgroundColor3 = Color3.fromRGB(18, 18, 26)
Main.BorderSizePixel = 0
Main.Active = true
Main.Draggable = true
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 18)

-- Glow
local Glow = Instance.new("UIStroke", Main)
Glow.Thickness = 2
Glow.Color = Color3.fromRGB(120, 120, 255)
Glow.Transparency = 0.4

--// TITLE
local Title = Instance.new("TextLabel", Main)
Title.Size = UDim2.new(1, 0, 0, 44)
Title.BackgroundColor3 = Color3.fromRGB(28, 28, 40)
Title.Text = "âš¡ RIN TRADE SYSTEM"
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 18
Title.TextColor3 = Color3.fromRGB(180, 180, 255)
Instance.new("UICorner", Title).CornerRadius = UDim.new(0, 18)

--// STATUS
local Status = Instance.new("TextLabel", Main)
Status.Position = UDim2.new(0, 16, 0, 54)
Status.Size = UDim2.new(1, -32, 0, 24)
Status.BackgroundTransparency = 1
Status.Text = "Status: Not in trade"
Status.Font = Enum.Font.Gotham
Status.TextSize = 14
Status.TextXAlignment = Left
Status.TextColor3 = Color3.fromRGB(200,200,200)

--// TOGGLE HOLDER
local Holder = Instance.new("Frame", Main)
Holder.Position = UDim2.new(0, 16, 0, 88)
Holder.Size = UDim2.new(1, -32, 1, -110)
Holder.BackgroundTransparency = 1

local Layout = Instance.new("UIListLayout", Holder)
Layout.Padding = UDim.new(0, 14)

--// TRADE CHECK
local function checkTrade()
	local mainGui = gui:FindFirstChild("Main")
	if not mainGui then return false, "" end

	local trade = mainGui:FindFirstChild("Trade")
	if not trade or not trade.Visible then return false, "" end

	local cont = trade:FindFirstChild("Container")
	if not cont then return false, "" end

	local a, b = cont:FindFirstChild("1"), cont:FindFirstChild("2")
	if not a or not b then return false, "" end

	local t1, t2 = a:FindFirstChild("TextLabel"), b:FindFirstChild("TextLabel")
	if not t1 or not t2 then return false, "" end

	local me = string.lower(player.Name)
	local dme = string.lower(player.DisplayName)

	if string.lower(t1.Text) == me or string.lower(t1.Text) == dme then
		return true, t2.Text
	elseif string.lower(t2.Text) == me or string.lower(t2.Text) == dme then
		return true, t1.Text
	end

	return false, ""
end

--// TOGGLE CREATOR (VISUAL DIFFERENCE HERE)
local toggles = {}

local function createToggle(text)
	local Row = Instance.new("Frame", Holder)
	Row.Size = UDim2.new(1, 0, 0, 46)
	Row.BackgroundColor3 = Color3.fromRGB(30, 30, 44)
	Instance.new("UICorner", Row).CornerRadius = UDim.new(0, 14)

	local Stroke = Instance.new("UIStroke", Row)
	Stroke.Color = Color3.fromRGB(100,100,180)
	Stroke.Transparency = 0.6

	local Label = Instance.new("TextLabel", Row)
	Label.Position = UDim2.new(0, 14, 0, 0)
	Label.Size = UDim2.new(1, -90, 1, 0)
	Label.BackgroundTransparency = 1
	Label.Text = text
	Label.Font = Enum.Font.GothamMedium
	Label.TextSize = 14
	Label.TextXAlignment = Left
	Label.TextColor3 = Color3.fromRGB(230,230,255)

	local Switch = Instance.new("Frame", Row)
	Switch.Size = UDim2.new(0, 54, 0, 26)
	Switch.Position = UDim2.new(1, -68, 0.5, -13)
	Switch.BackgroundColor3 = Color3.fromRGB(70,70,90)
	Instance.new("UICorner", Switch).CornerRadius = UDim.new(1,0)

	local Knob = Instance.new("Frame", Switch)
	Knob.Size = UDim2.new(0, 22, 0, 22)
	Knob.Position = UDim2.new(0, 2, 0.5, -11)
	Knob.BackgroundColor3 = Color3.fromRGB(255,90,90)
	Instance.new("UICorner", Knob).CornerRadius = UDim.new(1,0)

	toggles[text] = false

	Switch.InputBegan:Connect(function(i)
		if i.UserInputType ~= Enum.UserInputType.MouseButton1 then return end

		local ok = checkTrade()
		if not ok then return end

		toggles[text] = not toggles[text]

		TweenService:Create(Knob, TweenInfo.new(0.25), {
			Position = toggles[text] and UDim2.new(1,-24,0.5,-11) or UDim2.new(0,2,0.5,-11),
			BackgroundColor3 = toggles[text] and Color3.fromRGB(120,255,150) or Color3.fromRGB(255,90,90)
		}):Play()

		TweenService:Create(Switch, TweenInfo.new(0.25), {
			BackgroundColor3 = toggles[text] and Color3.fromRGB(80,120,100) or Color3.fromRGB(70,70,90)
		}):Play()
	end)
end

createToggle("Freeze Trade")
createToggle("Auto Accept")

--// STATUS UPDATE
RunService.Heartbeat:Connect(function()
	local inTrade, partner = checkTrade()
	if inTrade then
		Status.Text = "Trading with: " .. partner
		Status.TextColor3 = Color3.fromRGB(120,255,170)
	else
		Status.Text = "Status: Not in trade"
		Status.TextColor3 = Color3.fromRGB(200,200,200)
	end
end)
